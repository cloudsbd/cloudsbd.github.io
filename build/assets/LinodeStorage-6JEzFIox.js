import{r as j,mA as ie,j as e,bB as $,es as ne,gS as R,bp as M,cx as U,gT as le,dE as H,ad as L,ag as Q,ao as de,h2 as ce,h3 as me,h4 as ue,T as F,gV as pe,bM as ge,d0 as q,s as he,G as W,b as be,c as fe,ba as xe,dp as Ce,W as je}from"./index-cVx9Zqte.js";import{S as ve,b as Ve,L as Se}from"./LinodeDisks-zyiLqtd_.js";import{A as ye}from"./AddNewLink-EuioEAZT.js";import{P as De}from"./PaginationFooter-8MfyrbrN.js";import{b as Te,T as we,a as k,c as _e}from"./TableRow-WjckZ-OR.js";import{T as ze}from"./TableRowEmpty-HXunljlo.js";import{T as Pe}from"./TableRowError-VT_K71YW.js";import{T as Le}from"./TableRowLoading-enpzcj9B.js";import{T as E}from"./TableSortCell-N7Qxf5YK.js";import{P as Ie,a as Ee,E as Be,R as Oe,C as Ae,D as Re,b as Fe,V as qe}from"./VolumeTableRow-qJ0Y0A8H.js";import{u as ke}from"./useOrder-iGt70Yxe.js";import{u as Ne}from"./usePagination-oVzoT3VV.js";import{D as Ge}from"./Drawer-Zv-UzsLT.js";import{u as Y}from"./formik.esm-XrBweJub.js";import{h as K,a as X}from"./formikErrorUtils-k3dWKVdg.js";import{C as Z,S as $e}from"./SizeField-SuEqeaDl.js";import{a as Me}from"./Autocomplete-vchTD_Ph.js";import{T as Ue}from"./TagsInput-STVelb0H.js";import{m as B}from"./maybeCastToNumber-wtDkqjHp.js";import{R as N}from"./Radio-9QvviwDe.js";import{R as He}from"./RadioGroup-2qEaOjEa.js";import{T as Qe}from"./TableHead-aAnFvqns.js";import"./OrderBy-9siuTGWJ.js";import"./splitAt-OlbwoBj3.js";import"./Paginate-_mtRUOjJ.js";import"./disks-JZFpnfFj.js";import"./AccessPanel-c_TKWhs7.js";import"./CreateSSHKeyDrawer-Lk8yKKuD.js";import"./Code-EQsYwaVK.js";import"./formikTrimUtil-tfsUpEEv.js";import"./getAPIErrorFor-tzBGcA7R.js";import"./ImageSelect-2dUquSHq.js";import"./cond-OExnIwqZ.js";import"./groupBy-0b_eFpMI.js";import"./LinodePermissionsError-pDRXYuC4.js";import"./DateTimeDisplay-Ll7y9Gvy.js";import"./ActionMenu-LQcZWhDC.js";import"./InlineMenuAction-1MvHCfFL.js";import"./TextTooltip-h4BIBq-b.js";import"./Skeleton-Ei33_jCb.js";import"./TypeToConfirmDialog-OLeT3MiC.js";import"./TypeToConfirm-c9PkDm3L.js";import"./DisplayPrice-m9AmNFV_.js";import"./Currency-UAWCzS7H.js";import"./CopyableTextField-zKZIzq_h.js";import"./CopyTooltip-nIZAIwkd.js";import"./index-nat4f1EQ.js";import"./StatusIcon-d7wUM4gj.js";import"./constants-KokzTiEs.js";import"./dynamicPricing-n5eCZqTg.js";import"./LandingHeader--0FiA91-.js";import"./RegionSelect-bPwNTvP1.js";import"./Flag-3tAA4S-o.js";import"./ListItem-HwDJ8kDZ.js";import"./visuallyHidden-DVicuktI.js";import"./LinodeSelect-MycnhSc0.js";import"./FormControl-r0VmXCL0.js";import"./configs-neuBJQ0E.js";import"./concat-jPlDnPBS.js";import"./_isFunction-X3ooR5X_.js";import"./_contains-cAWwaXdv.js";import"./tags-i_yRfMC6.js";const We=d=>{const{disabled:t,error:n,onBlur:c,onChange:b,region:i,value:g}=d,[m,u]=j.useState(""),s=m?{"+or":[{label:{"+contains":m}},{tags:{"+contains":m}}]}:{},{data:f,fetchNextPage:v,hasNextPage:S,isLoading:h}=ie({...s,...i?{region:i}:{},"+order":"asc","+order_by":"label"}),x=f==null?void 0:f.pages.flatMap(r=>r.data).map(({id:r,label:a})=>({id:r,label:a})),p=(x==null?void 0:x.find(r=>r.id===g))??null;return e.jsx(Me,{ListboxProps:{onScroll:r=>{const a=r.currentTarget;a.scrollTop+a.clientHeight>=a.scrollHeight&&S&&v()}},onChange:(r,a)=>{b((a==null?void 0:a.id)??-1),u("")},onInputChange:(r,a,C)=>{u(C==="input"?a:"")},renderInput:r=>e.jsx($,{helperText:i&&"Only volumes in this Linode's region are attachable.",errorText:n,label:"Volume",onBlur:c,placeholder:"Select a Volume",...r}),disabled:t,inputValue:p?p.label:m,isOptionEqualToValue:r=>r.id===(p==null?void 0:p.id),loading:h,options:x??[],value:p})},Ye=ne({config_id:R().min(0,"Config is required.").required("Config is required."),volume_id:R().min(0,"Volume is required.").required("Volume is required.")}),Ke={config_id:-1,volume_id:-1},Xe=d=>{const{linode:t,onClose:n}=d,{data:c}=M(),{enqueueSnackbar:b}=U(),i=c==null?void 0:c.linode.find(a=>a.id===t.id),g=(i==null?void 0:i.permissions)==="read_only",{mutateAsync:m}=le(),{errors:u,handleBlur:s,handleSubmit:f,isSubmitting:v,resetForm:S,setFieldValue:h,status:x,touched:p,values:r}=Y({initialValues:Ke,async onSubmit(a,{setErrors:C,setStatus:l,setSubmitting:y}){try{await m({config_id:a.config_id,linode_id:t.id,volumeId:a.volume_id}),n(),H(),b("Volume attachment started",{variant:"info"})}catch(V){y(!1),K(C,V),X(l,V,"Unable to attach this volume at this time. Please try again later.")}},validationSchema:Ye});return e.jsxs("form",{onSubmit:f,children:[g&&e.jsx(L,{text:"You don't have permissions to add a Volume for this Linode. Please contact an account administrator for details.",important:!0,variant:"error"}),x&&e.jsx(L,{text:x,variant:"error"}),e.jsx(We,{disabled:g,error:p.volume_id?u.volume_id:void 0,onBlur:s,onChange:a=>h("volume_id",a),region:t.region,value:r.volume_id}),e.jsx(Z,{disabled:g,error:p.config_id?u.config_id:void 0,linodeId:t.id,name:"config_id",onBlur:s,onChange:a=>h("config_id",a),value:r.config_id}),e.jsx(Q,{primaryButtonProps:{disabled:g,label:"Attach Volume",loading:v,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:()=>{S(),n()}}})]})},Ze={config_id:-1,label:"",linode_id:-1,region:"none",size:20,tags:[]},Je=d=>{const{linode:t,onClose:n,openDetails:c}=d,{enqueueSnackbar:b}=U(),{data:i}=de(),{data:g}=M(),{mutateAsync:m}=ce(),u=(i==null?void 0:i.restricted)&&!(g!=null&&g.global.add_volumes),{errors:s,handleBlur:f,handleChange:v,handleSubmit:S,isSubmitting:h,resetForm:x,setFieldValue:p,status:r,touched:a,values:C}=Y({initialValues:Ze,async onSubmit(l,{setErrors:y,setStatus:V}){const{config_id:w,label:_,size:z,tags:P}=l;V(void 0);try{const D=await m({config_id:w===-1?void 0:B(w),label:_,linode_id:B(t.id),size:B(z),tags:P});H(),b("Volume scheduled for creation.",{variant:"success"}),n(),c(D),me(`Size: ${z}GB`,origin)}catch(D){K(y,D),X(V,D,"Unable to create a volume at this time. Please try again later.")}},validationSchema:ue});return e.jsxs("form",{onSubmit:S,children:[u&&e.jsx(L,{text:"You don't have permissions to create a new Volume. Please contact an account administrator for details.",important:!0}),r&&e.jsx(L,{text:r,variant:"error"}),e.jsx(F,{sx:l=>({marginBottom:l.spacing(1.25)}),"data-qa-volume-attach-help":!0,style:{marginTop:24},variant:"body1",children:`This volume will be immediately scheduled for attachment to ${t.label} and available to other Linodes in the ${t.region} data-center.`}),e.jsx(F,{sx:l=>({marginBottom:l.spacing(1.25)}),"data-qa-volume-size-help":!0,variant:"body1",children:e.jsxs("span",{children:["A single Volume can range from 10 to ",pe," GB in size. Up to eight Volumes can be attached to a single Linode."]})}),e.jsx($,{"data-qa-volume-label":!0,disabled:u,errorText:a.label?s.label:void 0,label:"Label",name:"label",onBlur:f,onChange:v,required:!0,value:C.label}),e.jsx($e,{disabled:u,error:a.size?s.size:void 0,isFromLinode:!0,name:"size",onBlur:f,onChange:v,regionId:t.region,value:C.size}),e.jsx(Z,{disabled:u,error:a.config_id?s.config_id:void 0,linodeId:t.id,name:"configId",onBlur:f,onChange:l=>p("config_id",l),value:C.config_id}),e.jsx(Ue,{onChange:l=>p("tags",l.map(y=>y.value)),tagError:a.tags&&s.tags?ge(s.tags,"Unable to tag volume."):void 0,disabled:u,label:"Tags",name:"tags",value:C.tags.map(l=>({label:l,value:l}))}),e.jsx(Ie,{currentSize:10,regionId:t.region,value:C.size}),e.jsx(Q,{primaryButtonProps:{disabled:u,label:"Create Volume",loading:h,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:()=>{x(),n()}}})]})},ea=({mode:d,onChange:t})=>e.jsxs(He,{"aria-label":"mode",name:"mode",onChange:(n,c)=>t(c),value:d,children:[e.jsx(q,{control:e.jsx(N,{}),"data-qa-radio":"Create and Attach Volume",label:"Create and Attach Volume",value:"create"}),e.jsx(q,{control:e.jsx(N,{}),"data-qa-radio":"Attach Existing Volume",label:"Attach Existing Volume",value:"attach"})]}),aa=d=>{const{linode:t,onClose:n,open:c,openDetails:b}=d,[i,g]=j.useState("create");return e.jsxs(Ge,{title:i==="attach"?`Attach Volume to ${t.label}`:`Create Volume for ${t.label}`,onClose:n,open:c,children:[e.jsx(ea,{mode:i,onChange:g}),i==="attach"?e.jsx(Xe,{linode:t,onClose:n}):e.jsx(Je,{linode:t,onClose:n,openDetails:b})]})},G="linode-volumes",oa=()=>{const{linodeId:d}=be(),t=Number(d),{data:n}=fe(t),{handleOrderChange:c,order:b,orderBy:i}=ke({order:"desc",orderBy:"label"},`${G}-order`),g={"+order":b,"+order_by":i},m=Ne(1,G),u=xe().data??[],{data:s,error:f,isLoading:v}=Ce(t,{page:m.page,page_size:m.pageSize},g),[S,h]=j.useState(),[x,p]=j.useState(!1),[r,a]=j.useState(!1),[C,l]=j.useState(!1),[y,V]=j.useState(!1),[w,_]=j.useState(!1),[z,P]=j.useState(!1),[D,O]=j.useState(!1),T=s==null?void 0:s.data.find(o=>o.id===S),J=o=>{h(o.id),P(!0)},ee=o=>{h(o.id),O(!0)},A=o=>{h(o.id),p(!0)},ae=o=>{h(o.id),a(!0)},oe=o=>{h(o.id),l(!0)},te=o=>{h(o.id),V(!0)},se=()=>{_(!0)},I=u.find(o=>o.id===(n==null?void 0:n.region));if(!(I!=null&&I.capabilities.includes("Block Storage")))return null;const re=()=>v?e.jsx(Le,{responsive:{3:{xsDown:!0}},columns:5,rows:1}):f?e.jsx(Pe,{colSpan:6,message:f[0].reason}):(s==null?void 0:s.results)===0?e.jsx(ze,{colSpan:5,message:"No Volumes to display."}):s?s.data.map(o=>e.jsx(qe,{handlers:{handleAttach:()=>null,handleClone:()=>te(o),handleDelete:()=>ee(o),handleDetach:()=>J(o),handleDetails:()=>A(o),handleEdit:()=>ae(o),handleResize:()=>oe(o)},isDetailsPageRow:!0,volume:o},o.id)):null;return e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsxs(ve,{alignItems:"flex-end",container:!0,justifyContent:"space-between",spacing:1,children:[e.jsx(W,{className:"p0",children:e.jsx(Ve,{variant:"h3",children:"Volumes"})}),e.jsx(ta,{children:e.jsx(ye,{disabled:!1,label:"Create Volume",onClick:se})})]}),e.jsxs(Te,{children:[e.jsx(Qe,{children:e.jsxs(we,{children:[e.jsx(E,{active:i==="label",direction:b,handleClick:c,label:"label",children:"Label"}),e.jsx(E,{active:i==="status",direction:b,handleClick:c,label:"status",children:"Status"}),e.jsx(E,{active:i==="size",direction:b,handleClick:c,label:"size",children:"Size"}),e.jsx(je,{xsDown:!0,children:e.jsx(k,{children:"File System Path"})}),e.jsx(k,{})]})}),e.jsx(_e,{children:re()})]}),e.jsx(De,{count:(s==null?void 0:s.results)??0,eventCategory:"Volumes Table",handlePageChange:m.handlePageChange,handleSizeChange:m.handlePageSizeChange,page:m.page,pageSize:m.pageSize}),n&&e.jsx(aa,{linode:n,onClose:()=>_(!1),open:w,openDetails:A}),e.jsx(Ee,{onClose:()=>p(!1),open:x,volume:T}),e.jsx(Be,{onClose:()=>a(!1),open:r,volume:T}),e.jsx(Oe,{onClose:()=>l(!1),open:C,volume:T}),e.jsx(Ae,{onClose:()=>V(!1),open:y,volume:T}),e.jsx(Re,{onClose:()=>P(!1),open:z,volume:T}),e.jsx(Fe,{onClose:()=>O(!1),open:D,volume:T})]})},ta=he(W,{label:"StyledNewWrapperGrid"})(({theme:d})=>({"&.MuiGrid-item":{padding:5},[d.breakpoints.down("sm")]:{marginLeft:`-${d.spacing(1.5)}`,marginTop:`-${d.spacing(1)}`}})),po=()=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(oa,{})]});export{po as LinodeStorage,po as default};
