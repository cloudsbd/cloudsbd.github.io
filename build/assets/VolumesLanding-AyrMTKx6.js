import{es as K,gS as I,r as i,cx as Q,bp as U,gT as Y,j as e,ad as T,bJ as J,bI as W,ag as X,dE as ee,s as te,gB as oe,u as B,Q as P,di as ae,e as se,gU as re,E as ie,an as ne}from"./index-cVx9Zqte.js";import{L as le}from"./LandingHeader--0FiA91-.js";import{L as de}from"./LandingLoading-qov_vRgM.js";import{P as ce}from"./PaginationFooter-8MfyrbrN.js";import{b as ue,T as me,a as k,c as ge}from"./TableRow-WjckZ-OR.js";import{T as v}from"./TableSortCell-N7Qxf5YK.js";import{u as pe}from"./useOrder-iGt70Yxe.js";import{u as he}from"./usePagination-oVzoT3VV.js";import{u as fe}from"./formik.esm-XrBweJub.js";import{D as xe}from"./Drawer-Zv-UzsLT.js";import{F as be}from"./FormControl-r0VmXCL0.js";import{L as we}from"./LinodeSelect-MycnhSc0.js";import{u as Ce}from"./configs-neuBJQ0E.js";import{g as Se}from"./getAPIErrorFor-tzBGcA7R.js";import{V as De,a as Ve,E as je,R as ye,C as ke,D as ve,b as Le}from"./VolumeTableRow-qJ0Y0A8H.js";import{a as Oe,d as Ee,y as _e,b as Ie,R as Te}from"./ResourcesSection-Ho8bmvI2.js";import{T as Ae}from"./TableHead-aAnFvqns.js";import"./OrderBy-9siuTGWJ.js";import"./splitAt-OlbwoBj3.js";import"./Autocomplete-vchTD_Ph.js";import"./formikErrorUtils-k3dWKVdg.js";import"./TypeToConfirmDialog-OLeT3MiC.js";import"./TypeToConfirm-c9PkDm3L.js";import"./TagsInput-STVelb0H.js";import"./concat-jPlDnPBS.js";import"./_isFunction-X3ooR5X_.js";import"./_contains-cAWwaXdv.js";import"./tags-i_yRfMC6.js";import"./DisplayPrice-m9AmNFV_.js";import"./Currency-UAWCzS7H.js";import"./SizeField-SuEqeaDl.js";import"./constants-KokzTiEs.js";import"./dynamicPricing-n5eCZqTg.js";import"./RegionSelect-bPwNTvP1.js";import"./Flag-3tAA4S-o.js";import"./ListItem-HwDJ8kDZ.js";import"./visuallyHidden-DVicuktI.js";import"./maybeCastToNumber-wtDkqjHp.js";import"./CopyableTextField-zKZIzq_h.js";import"./CopyTooltip-nIZAIwkd.js";import"./index-nat4f1EQ.js";import"./StatusIcon-d7wUM4gj.js";import"./ActionMenu-LQcZWhDC.js";import"./InlineMenuAction-1MvHCfFL.js";const ze=K({config_id:I().min(0,"Config is required.").required("Config is required."),linode_id:I().min(0,"Linode is required.").required("Linode is required.")}),Be=i.memo(u=>{var C;const{open:p,volume:a}=u,{enqueueSnackbar:h}=Q(),{data:n}=U(),{error:l,mutateAsync:S}=Y(),o=fe({initialValues:{config_id:-1,linode_id:-1},async onSubmit(s){await S({volumeId:(a==null?void 0:a.id)??-1,...s}).then(()=>{ee(),g(),h("Volume attachment started",{variant:"info"})})},validateOnBlur:!1,validateOnChange:!1,validationSchema:ze}),{data:w,isLoading:D}=Ce(o.values.linode_id,o.values.linode_id!==-1),m=w??[],r=m.map(s=>({label:s.label,value:`${s.id}`}));i.useEffect(()=>{m.length===1&&o.setFieldValue("config_id",m[0].id)},[m]);const V=()=>{o.resetForm()},g=()=>{V(),u.onClose()},j={linode_id:"Linode",overwrite:"Overwrite"},d=n!==void 0&&((C=n.volume.find(s=>s.id===(a==null?void 0:a.id)))==null?void 0:C.permissions)==="read_only",f=Se(j,l===null?void 0:l),x=f("linode_id"),y=f("config_id"),b=f("none");return e.jsx(xe,{onClose:g,open:p,title:`Attach Volume ${a==null?void 0:a.label}`,children:e.jsxs("form",{onSubmit:o.handleSubmit,children:[d&&e.jsx(T,{text:"You don't have permission to edit this volume.",variant:"error"}),b&&e.jsx(T,{text:b,variant:"error"}),e.jsx(we,{onSelectionChange:s=>{s!==null&&o.setFieldValue("linode_id",s.id)},clearable:!1,disabled:d,errorText:o.errors.linode_id??x,filter:{region:a==null?void 0:a.region},noMarginTop:!0,value:o.values.linode_id}),!x&&e.jsx(J,{children:"Only Linodes in this Volumeâ€™s region are displayed."}),e.jsx(be,{fullWidth:!0,children:e.jsx(W,{onChange:s=>o.setFieldValue("config_id",Number(s.value)),value:r.find(s=>s.value===String(o.values.config_id)),disabled:d||o.values.linode_id===-1,errorText:o.errors.config_id??y,id:"config_id",isClearable:!1,isLoading:D,label:"Config",name:"config_id",noMarginTop:!0,options:r,placeholder:"Select a Config"})}),e.jsx(X,{primaryButtonProps:{"data-testid":"submit",disabled:d,label:"Attach",loading:o.isSubmitting,type:"submit"},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:g}})]})})}),Pe=te(oe)(()=>({transform:"scale(0.75)"})),Re={description:"Attach scalable, fault-tolerant, and performant block storage volumes to your Linode Compute Instances or Kubernetes Clusters.",subtitle:"NVMe block storage service",title:"Volumes"},Fe={links:[{text:"Overview of Block Storage",to:"https://www.linode.com/docs/products/storage/block-storage/"},{text:"Create and Manage Block Storage Volumes",to:"https://www.linode.com/docs/products/storage/block-storage/guides/"},{text:"Configure a Volume on a Compute Instance",to:"https://www.linode.com/docs/products/storage/block-storage/guides/configure-volume/"}],moreInfo:{text:Oe,to:Ee},title:"Getting Started Guides"},Me={links:[{external:!0,text:"How to Use Block Storage with Your Linode",to:"https://www.youtube.com/watch?v=7ti25oK7UMA"},{external:!0,text:"Block Storage Vs Object Storage",to:"https://www.youtube.com/watch?v=8G0cNZZIxNc"},{external:!0,text:"How to use Block Storage to Increase Space on Your Nextcloud Instance",to:"https://www.youtube.com/watch?v=Z9jZv_IHO2s"}],moreInfo:{text:_e,to:Ie},title:"Video Playlist"},A={action:"Click:link",category:"Volumes landing page empty"},qe=()=>{const{push:u}=B();return e.jsxs(e.Fragment,{children:[e.jsx(P,{segment:"Volumes"}),e.jsx(Te,{buttonProps:[{children:"Create Volume",onClick:()=>{ae({action:"Click:button",category:A.category,label:"Create Volume"}),u("/volumes/create")}}],gettingStartedGuidesData:Fe,headers:Re,icon:Pe,linkAnalyticsEvent:A,youtubeLinkData:Me})]})},z="volumes",It=()=>{var E,_;const u=B(),p=se(),a=he(1,z),{handleOrderChange:h,order:n,orderBy:l}=pe({order:"desc",orderBy:"label"},`${z}-order`),S={"+order":n,"+order_by":l},{data:o,error:w,isLoading:D}=re({page:a.page,page_size:a.pageSize},S),[m,r]=i.useState(),[V,g]=i.useState(!!((E=p.state)!=null&&E.volume)),[j,d]=i.useState(!1),[f,x]=i.useState(!1),[y,b]=i.useState(!1),[C,s]=i.useState(!1),[R,L]=i.useState(!1),[F,O]=i.useState(!1),c=o==null?void 0:o.data.find(t=>t.id===m),M=t=>{r(t.id),L(!0)},q=t=>{r(t.id),O(!0)},H=t=>{r(t.id),g(!0)},G=t=>{r(t.id),d(!0)},N=t=>{r(t.id),x(!0)},Z=t=>{r(t.id),b(!0)},$=t=>{r(t.id),s(!0)};return D?e.jsx(de,{}):w?e.jsx(ie,{errorText:ne(w,"Error loading your volumes.")[0].reason}):(o==null?void 0:o.results)===0?e.jsx(qe,{}):e.jsxs(e.Fragment,{children:[e.jsx(P,{segment:"Volumes"}),e.jsx(le,{docsLink:"https://www.linode.com/docs/platform/block-storage/how-to-use-block-storage-with-your-linode/",entity:"Volume",onButtonClick:()=>u.push("/volumes/create"),title:"Volumes"}),e.jsxs(ue,{children:[e.jsx(Ae,{children:e.jsxs(me,{children:[e.jsx(v,{active:l==="label",direction:n,handleClick:h,label:"label",children:"Label"}),e.jsx(v,{active:l==="status",direction:n,handleClick:h,label:"status",children:"Status"}),e.jsx(k,{children:"Region"}),e.jsx(v,{active:l==="size",direction:n,handleClick:h,label:"size",children:"Size"}),e.jsx(k,{children:"Attached To"}),e.jsx(k,{})]})}),e.jsx(ge,{children:o==null?void 0:o.data.map(t=>e.jsx(De,{handlers:{handleAttach:()=>$(t),handleClone:()=>Z(t),handleDelete:()=>q(t),handleDetach:()=>M(t),handleDetails:()=>H(t),handleEdit:()=>G(t),handleResize:()=>N(t)},volume:t},t.id))})]}),e.jsx(ce,{count:(o==null?void 0:o.results)??0,eventCategory:"Volumes Table",handlePageChange:a.handlePageChange,handleSizeChange:a.handlePageSizeChange,page:a.page,pageSize:a.pageSize}),e.jsx(Be,{onClose:()=>s(!1),open:C,volume:c}),e.jsx(Ve,{onClose:()=>{var t;g(!1),(t=p.state)!=null&&t.volume&&window.history.replaceState(null,"")},open:V,volume:c??((_=p.state)==null?void 0:_.volume)}),e.jsx(je,{onClose:()=>d(!1),open:j,volume:c}),e.jsx(ye,{onClose:()=>x(!1),open:f,volume:c}),e.jsx(ke,{onClose:()=>b(!1),open:y,volume:c}),e.jsx(ve,{onClose:()=>L(!1),open:R,volume:c}),e.jsx(Le,{onClose:()=>O(!1),open:F,volume:c})]})};export{It as VolumesLanding,It as default};
