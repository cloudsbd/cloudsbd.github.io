import{U as v,j as e,V as D,W as l,X as P,T as E,Y as O,r as d,e as z,u as B,h as $,Q as R}from"./index-cVx9Zqte.js";import{L as W}from"./LandingHeader--0FiA91-.js";import{a as H,b as F,c as y,T as _,d as f}from"./TabList-Vcpmm6u6.js";import{S as A}from"./SupportTicketDialog-OsiQ7_Xj.js";import{P as Q}from"./PaginationFooter-8MfyrbrN.js";import{T as q,a as c,b as K,c as U}from"./TableRow-WjckZ-OR.js";import{T as I}from"./TableRowEmpty-HXunljlo.js";import{T as M}from"./TableRowError-VT_K71YW.js";import{T as N}from"./TableRowLoading-enpzcj9B.js";import{T as u}from"./TableSortCell-N7Qxf5YK.js";import{u as V}from"./useOrder-iGt70Yxe.js";import{u as X}from"./usePagination-oVzoT3VV.js";import{D as k}from"./DateTimeDisplay-Ll7y9Gvy.js";import{T as Y}from"./TableHead-aAnFvqns.js";import"./scrollErrorIntoView-6n4Cku1Y.js";import"./TabbedReply-6vlVk1ew.js";import"./remove-2JFCky0p.js";import"./TabbedPanel-7MRGLWE6.js";import"./Skeleton-Ei33_jCb.js";import"./OrderBy-9siuTGWJ.js";import"./splitAt-OlbwoBj3.js";const G=t=>{const n=P(t.entity);return t.entity?n!==null?e.jsx(D,{className:"secondaryLink",to:n,children:t.entity.label}):e.jsx(E,{children:t.entity.label}):null},J=({ticket:t})=>{const n=v({disallowedTagsMode:"discard",sanitizingTier:"none",text:t.summary}).toString();return e.jsxs(q,{ariaLabel:`Ticket subject ${n}`,"data-qa-support-ticket":t.id,"data-testid":"ticket-row",children:[e.jsx(c,{"data-qa-support-subject":!0,children:e.jsx(D,{to:`/support/tickets/${t.id}`,children:n})}),e.jsx(l,{mdDown:!0,children:e.jsx(c,{"data-qa-support-id":!0,children:t.id})}),e.jsx(c,{sx:{lineHeight:1.1},"data-qa-support-entity":!0,children:G(t)}),e.jsx(l,{smDown:!0,children:e.jsx(c,{"data-qa-support-date":!0,children:e.jsx(k,{value:t.opened})})}),e.jsx(c,{"data-qa-support-updated":!0,children:e.jsx(k,{value:t.updated})}),e.jsx(l,{mdDown:!0,children:e.jsx(c,{"data-qa-support-updated-by":!0,children:t.updated_by})})]},`ticket-${t.id}`)},Z=t=>{switch(t){case"open":return{"+or":[{status:"open"},{status:"new"}]};case"closed":return{status:"closed"};case"all":return{};default:return new Error('Argument must be "open", "closed", or "all"')}},S="support-tickets",w=t=>{const{filterStatus:n,newTicket:m}=t,r=X(1,S),{handleOrderChange:i,order:a,orderBy:h}=V({order:"desc",orderBy:"opened"},`${S}-order`),j={"+order":a,"+order_by":h},{data:o,error:T,isLoading:g,refetch:b}=O({page:r.page,page_size:r.pageSize},{...j,...Z(n)});d.useEffect(()=>{b()},[m]);const x=()=>g?e.jsx(N,{responsive:{1:{smDown:!0},3:{xsDown:!0},5:{smDown:!0}},columns:6}):T?e.jsx(M,{colSpan:8,message:"We were unable to load your support tickets."}):o&&o.results>0?o.data.map((p,L)=>e.jsx(J,{ticket:p},`ticket-row-${L}`)):e.jsx(I,{colSpan:8}),s=p=>p===h;return e.jsxs(e.Fragment,{children:[e.jsxs(K,{"aria-label":"List of Tickets",children:[e.jsx(Y,{children:e.jsxs(q,{children:[e.jsx(u,{active:s("summary"),"data-qa-support-subject-header":!0,direction:a,handleClick:i,label:"summary",noWrap:!0,children:"Subject"}),e.jsx(l,{mdDown:!0,children:e.jsx(u,{active:s("id"),"data-qa-support-id-header":!0,direction:a,handleClick:i,label:"id",noWrap:!0,children:"Ticket ID"})}),e.jsx(c,{"data-qa-support-regarding-header":!0,children:"Regarding"}),e.jsx(l,{smDown:!0,children:e.jsx(u,{active:s("opened"),"data-qa-support-date-header":!0,direction:a,handleClick:i,label:"opened",noWrap:!0,children:"Date Created"})}),e.jsx(u,{active:s("updated"),"data-qa-support-updated-header":!0,direction:a,handleClick:i,label:"updated",noWrap:!0,children:"Last Updated"}),e.jsx(l,{mdDown:!0,children:e.jsx(u,{active:s("updated_by"),"data-qa-support-updated-by-header":!0,direction:a,handleClick:i,label:"updated_by",noWrap:!0,children:"Updated By"})})]})}),e.jsx(U,{children:x()})]}),e.jsx(Q,{count:(o==null?void 0:o.results)??0,eventCategory:"ticket list",handlePageChange:r.handlePageChange,handleSizeChange:r.handlePageSizeChange,page:r.page,pageSize:r.pageSize})]})},C=["open","closed"],ee=()=>{const t=z(),n=B(),m=$(t.search),r=t.state,[i,a]=d.useState(r?r.open:m.drawerOpen==="true"),[h]=d.useState(r?r.description:void 0),[j]=d.useState(r?r.title:void 0),[o]=d.useState(r?r.entity:void 0),[T]=d.useState(r?r.ticketType:void 0),g=(s,p=[])=>{n.push({pathname:`/support/tickets/${s}`,state:{attachmentErrors:p}}),a(!1)},b=s=>{s.key==="Enter"&&a(!0)},x=C.indexOf(m.type);return e.jsxs(d.Fragment,{children:[e.jsx(R,{segment:"Support Tickets"}),e.jsx(W,{buttonDataAttrs:{"data-qa-open-ticket-link":!0},createButtonText:"Open New Ticket","data-qa-breadcrumb":!0,onButtonClick:()=>a(!0),onButtonKeyPress:b,title:"Tickets"}),e.jsxs(H,{onChange:s=>{n.push(`/support/tickets?type=${C[s]}`)},index:x===-1?0:x,children:[e.jsxs(F,{children:[e.jsx(y,{"data-qa-tab":"Open Tickets",children:"Open Tickets"}),e.jsx(y,{"data-qa-tab":"Closed Tickets",children:"Closed Tickets"})]}),e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(w,{filterStatus:"open"})}),e.jsx(f,{children:e.jsx(w,{filterStatus:"closed"})})]})]}),e.jsx(A,{onClose:()=>a(!1),onSuccess:g,open:i,prefilledDescription:h,prefilledEntity:o,prefilledTicketType:T,prefilledTitle:j})]})},ke=ee;export{ke as default};
