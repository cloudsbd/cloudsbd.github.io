var N=Object.defineProperty;var U=(a,i,e)=>i in a?N(a,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[i]=e;var r=(a,i,e)=>(U(a,typeof i!="symbol"?i+"":i,e),e);import{c9 as x,f4 as O,dg as W,r as b,ba as z,dM as G,bt as D,N as j,fR as Q,fS as K,e as $,q as Y,bg as q,fT as H,fU as Z,dw as X,fV as J,cg as A,cA as P,g as ee,h as L,cS as C,j as S,Q as te,G as se,fW as ae,fX as ie,fY as oe,an as y,fZ as re,f_ as ne,f$ as k,dD as de,g0 as le,i as ce,g1 as pe,d4 as he,d5 as me,dE as ge}from"./index-cVx9Zqte.js";import{L as ue}from"./LandingHeader--0FiA91-.js";import{P as Ie}from"./ProductInformationBanner-F-a7gVWs.js";import{w as fe}from"./images.container-x0qDJSHd.js";import{w as Se}from"./image.helpers-Yu4Zv1TD.js";import{w as be}from"./withQueryClient.container-zlDyK8fy.js";import{v as De}from"./vpcs-2oJlMVgq.js";import{a as w,i as ve,b as Ae}from"./RegionSelect-bPwNTvP1.js";import{U as Pe}from"./constants-KokzTiEs.js";import{s as u}from"./scrollErrorIntoView-6n4Cku1Y.js";import{v as Le}from"./validatePassword-xpiSI_1K.js";import{L as Ce}from"./LinodeCreate-AhlgivDs.js";import{_ as ye}from"./_isFunction-X3ooR5X_.js";import{t as ke}from"./concat-jPlDnPBS.js";import{g as we}from"./LinodeActionMenu-9Oio_i3b.js";import{g as Ee}from"./linodes-orSDvVk7.js";import"./Autocomplete-vchTD_Ph.js";import"./Flag-3tAA4S-o.js";import"./ListItem-HwDJ8kDZ.js";import"./visuallyHidden-DVicuktI.js";import"./main-d_A-GefV.js";import"./AccessPanel-c_TKWhs7.js";import"./TableRow-WjckZ-OR.js";import"./TableRowEmpty-HXunljlo.js";import"./TableRowError-VT_K71YW.js";import"./CreateSSHKeyDrawer-Lk8yKKuD.js";import"./formik.esm-XrBweJub.js";import"./Code-EQsYwaVK.js";import"./Drawer-Zv-UzsLT.js";import"./formikTrimUtil-tfsUpEEv.js";import"./getAPIErrorFor-tzBGcA7R.js";import"./usePagination-oVzoT3VV.js";import"./PaginationFooter-8MfyrbrN.js";import"./TableRowLoading-enpzcj9B.js";import"./Skeleton-Ei33_jCb.js";import"./TableHead-aAnFvqns.js";import"./SelectRegionPanel-tc9NCVA7.js";import"./RegionHelperText-EdACTeDg.js";import"./SelectFirewallPanel-pXR_GwwW.js";import"./CreateFirewallDrawer-WeFzxuJ-.js";import"./LinodeSelect-MycnhSc0.js";import"./NodeBalancerSelect-OAwV1VhJ.js";import"./formikErrorUtils-k3dWKVdg.js";import"./grants-2yY1GgvJ.js";import"./LinkButton-hNQEI-6q.js";import"./TagsInput-STVelb0H.js";import"./tags-i_yRfMC6.js";import"./SafeTabPanel-mYwDHsH9.js";import"./TabList-Vcpmm6u6.js";import"./TabLinkList-d9SkE5Nv.js";import"./SMTPRestrictionText-rA26g_88.js";import"./PlansPanel-1fa_pWJg.js";import"./TabbedPanel-7MRGLWE6.js";import"./PlanInformation-hdt1MDMd.js";import"./TextTooltip-h4BIBq-b.js";import"./Currency-UAWCzS7H.js";import"./Radio-9QvviwDe.js";import"./SelectionCard-z2Lwslro.js";import"./dynamicPricing-n5eCZqTg.js";import"./InterfaceSelect--puDy1pP.js";import"./constants-jI3mcPVd.js";import"./useCreateVPC-uMmXT9pV.js";import"./filterCurrentLinodeTypes-6QsXu4XU.js";import"./backups-brLSog0e.js";import"./ipUtils-8Z2b8Iiq.js";import"./ipaddr-2fi-A9R9.js";import"./CopyTooltip-nIZAIwkd.js";import"./index-nat4f1EQ.js";import"./toInteger-7fabGTYq.js";import"./assocPath-K5W2bQH9.js";import"./DebouncedSearchTextField-fJN9axDi.js";import"./stackscripts-siJ8mX0s.js";import"./LandingLoading-qov_vRgM.js";import"./Paginate-_mtRUOjJ.js";import"./RenderGuard-G_iNJx_w.js";import"./_contains-cAWwaXdv.js";import"./immer.esm--MpJ8fpr.js";import"./groupBy-0b_eFpMI.js";import"./arePropsEqual-WL8SjyyC.js";import"./getSelectedOptionFromGroupedOptions-3OaG4wtm.js";import"./CommonStackScript.styles-G8qJvONR.js";import"./index-m2Nl9sJq.js";import"./TableSortCell-N7Qxf5YK.js";import"./ResourcesSection-Ho8bmvI2.js";import"./StackScript-i54gdxpR.js";import"./DateTimeDisplay-Ll7y9Gvy.js";import"./ShowMoreExpansion-g4pF4U0E.js";import"./ActionMenu-LQcZWhDC.js";import"./lishUtils-9MoIA_uJ.js";import"./linodes--kIa80QO.js";var Ve=x(function(i,e){return O(i+1,function(){var t=arguments[i];if(t!=null&&ye(t[e]))return t[e].apply(t,Array.prototype.slice.call(arguments,0,i));throw new TypeError(ke(t)+' does not have a method named "'+e+'"')})}),Te=Ve(1,"join");const _e=a=>i=>{const e=W();return b.createElement(a,{...i,accountSettings:e})},Re=a=>i=>{const{data:e,error:t,isLoading:s}=z();return b.createElement(a,{regionsData:e??[],regionsError:t??void 0,regionsLoading:s,...i})},Me=(a,i=!0)=>e=>{const{data:t,error:s,isLoading:o}=G(i);return D.createElement(a,{...e,typesData:t,typesError:s??void 0,typesLoading:o})},Be=(a,i=!0)=>e=>{const{data:t,error:s,isLoading:o}=j({},{},i),{mutateAsync:n}=Q(),{mutateAsync:d}=K();return D.createElement(a,{...e,linodeActions:{cloneLinode:d,createLinode:n},linodesData:t,linodesError:s,linodesLoading:o})},Fe=a=>({...a,label:a.label.replace("One-Click","")}),Ne=a=>i=>{var g;const e=$(),t=Y(),o=q(e.search,"type")==="One-Click",{data:n,error:d,isLoading:l}=H(o),h=t.oneClickApps||[],p=Object.keys({...Z,...h}),m=(n??[]).filter(f=>!f.label.match(/helpers/i)&&p.includes(String(f.id))).map(f=>Fe(f));return D.createElement(a,{...i,appInstances:m,appInstancesError:(g=d==null?void 0:d[0])==null?void 0:g.reason,appInstancesLoading:l})},Ue=a=>i=>{const e=X();return b.createElement(a,{...i,agreements:e})},E=28,xe=/[^a-zA-Z0-9-_]/g,Oe=(a,i)=>ze(We(a),i),We=a=>{const i=J(Boolean)(a),e=A(n=>n.replace(xe,"").toLowerCase())(i),t=Te("-");if(t(e).length<=E)return P(V,t)(e);const s=i.length-1,o=Math.floor((E-s)/i.length);return P(V,t,A(n=>n.slice(0,o)))(e)},V=a=>a.replace(/--/g,"-").replace(/__/g,"_"),ze=(a,i)=>{let t=a,s=1;const o=i.filter(d=>d.startsWith(a)),n=d=>d===t;for(;o.find(n);)if(t=a+"-"+s.toString().padStart(3,"0"),s++,s===999)return a;return t},Ge="linode/debian11",T={assignPublicIPv4Address:!1,attachedVLANLabel:"",authorized_users:[],autoassignIPv4WithinVPCEnabled:!0,backupsEnabled:!1,customLabel:void 0,disabledClasses:[],errors:void 0,formIsSubmitting:!1,password:"",privateIPEnabled:!1,selectedBackupID:void 0,selectedDiskSize:void 0,selectedImageID:void 0,selectedLinodeID:void 0,selectedRegionID:"",selectedStackScriptID:void 0,selectedStackScriptLabel:"",selectedStackScriptUsername:"",selectedSubnetId:void 0,selectedTypeID:void 0,selectedVPCId:void 0,selectedfirewallId:void 0,showApiAwarenessModal:!1,showGDPRCheckbox:!1,signedAgreement:!1,tags:[],udfs:void 0,userData:void 0,vlanIPAMAddress:null,vpcIPv4AddressOfLinode:""},je=(a,i=[])=>{const e=i.find(s=>s.id===a),t=[];return e!=null&&e.capabilities.includes("GPU Linodes")||t.push("gpu"),e!=null&&e.capabilities.includes("Bare Metal")||t.push("metal"),t},B=["fromStackScript","fromBackup","fromLinode"],Qe=(a,i)=>B.some(e=>a!==e&&i===e);var _,R,M;class Ke extends b.PureComponent{constructor(){super(...arguments);r(this,"checkValidation",e=>{try{ie.validateSync(e,{abortEarly:!1}),this.setState({errors:void 0,showApiAwarenessModal:!0})}catch(t){const s=oe(t);this.setState(()=>({errors:y(s),formIsSubmitting:!1}),()=>u())}});r(this,"clearCreationState",()=>{this.setState(T)});r(this,"generateLabel",()=>{var g,f,v;const{createType:e,imagesData:t,regionsData:s}=this.props,{customLabel:o,selectedImageID:n,selectedLinodeID:d,selectedRegionID:l,selectedStackScriptLabel:h}=this.state;if(o!==void 0)return o;let p,I,m="";if(h)p=h;else if(n){const c=t[n];p=c?c.is_public?c.vendor:c.label:"",e==="fromApp"&&(p="")}if(l){const c=s.find(F=>F.id===l);I=c?c.id:""}return e==="fromLinode"&&(p=((f=(g=this.props.linodesData)==null?void 0:g.find(c=>c.id===d))==null?void 0:f.label)??p,I="clone",m=""),e==="fromBackup"&&(m="backup"),Oe([p,I,m],((v=this.props.linodesData)==null?void 0:v.map(c=>c.label))??[])});r(this,"getImageInfo",()=>{const{selectedImageID:e}=this.state;if(!e)return;const t=this.props.imagesData[e];if(!t)return;const{label:s,vendor:o}=t;return{title:`${s||o||""}`}});r(this,"getRegionInfo",()=>{const{selectedRegionID:e}=this.state;if(!e)return;const t=this.props.regionsData.find(s=>s.id===e);return t&&{title:t.label}});r(this,"getTypeInfo",()=>{var s;const{selectedTypeID:e}=this.state,t=(s=this.props.typesData)==null?void 0:s.find(o=>o.id===e);return this.reshapeTypeInfo(t?C(t):void 0)});r(this,"handleAgreementChange",()=>{this.setState(e=>({signedAgreement:!e.signedAgreement}))});r(this,"handleFirewallChange",e=>{this.setState({selectedfirewallId:e})});r(this,"handleShowApiAwarenessModal",()=>{this.setState(e=>({showApiAwarenessModal:!e.showApiAwarenessModal}))});r(this,"handleSubnetChange",e=>{this.setState(t=>{var s;return{errors:(s=t.errors)==null?void 0:s.filter(o=>o.field!=="interfaces[0].subnet_id"),selectedSubnetId:e}})});r(this,"handleVLANChange",e=>{this.setState({attachedVLANLabel:e.label,vlanIPAMAddress:e.ipam_address})});r(this,"handleVPCChange",e=>{e!==this.state.selectedVPCId&&this.setState({selectedSubnetId:void 0,selectedVPCId:e,vpcIPv4AddressOfLinode:""})});r(this,"handleVPCIPv4Change",e=>{this.setState({vpcIPv4AddressOfLinode:e})});r(this,"params",L(this.props.location.search));r(this,"reshapeTypeInfo",e=>{const{selectedRegionID:t}=this.state,s=Ee(e,t);return e&&{details:`$${s||Pe}/month`,hourly:s==null?void 0:s.hourly,monthly:s==null?void 0:s.monthly,title:e.formattedLabel}});r(this,"setAuthorizedUsers",e=>this.setState({authorized_users:e}));r(this,"setBackupID",e=>{this.setState({selectedBackupID:e})});r(this,"setDiskSize",e=>this.setState({selectedDiskSize:e}));r(this,"setImageID",e=>typeof e>"u"?this.setState({attachedVLANLabel:"",selectedImageID:void 0,vlanIPAMAddress:""}):this.setState({selectedImageID:e}));r(this,"setLinodeID",(e,t)=>{if(e!==this.state.selectedLinodeID){const s=we(this.props.linodesData,e);this.setState({selectedBackupID:void 0,selectedDiskSize:t,selectedLinodeID:e,selectedRegionID:s,selectedTypeID:void 0})}});r(this,"setPassword",e=>this.setState({password:e}));r(this,"setRegionID",e=>{var o;const{showGDPRCheckbox:t}=w({agreements:(o=this.props.agreements)==null?void 0:o.data,profile:this.props.profile.data,regions:this.props.regionsData,selectedRegionId:e}),s=je(e,this.props.regionsData);this.setState({disabledClasses:s,selectedRegionID:e,selectedSubnetId:void 0,selectedVPCId:-1,showGDPRCheckbox:t,vpcIPv4AddressOfLinode:""})});r(this,"setStackScript",(e,t,s,o,n,d)=>{const l=n.length===1?n[0].id:void 0,h=d!=null&&d.cluster_size?`${t} Cluster`:t;this.setState({availableStackScriptImages:n,availableUserDefinedFields:o,errors:void 0,selectedImageID:l,selectedStackScriptID:e,selectedStackScriptLabel:h,selectedStackScriptUsername:s,udfs:d})});r(this,"setTags",e=>this.setState({tags:e}));r(this,"setTypeID",e=>{/metal/.test(e)?this.setState({attachedVLANLabel:"",backupsEnabled:!1,selectedTypeID:e,vlanIPAMAddress:""}):this.setState({selectedTypeID:e})});r(this,"setUDFs",e=>this.setState({udfs:e}));r(this,"setUserData",e=>this.setState({userData:e}));r(this,"state",{...T,disabledClasses:[],selectedBackupID:isNaN(+this.params.backupID)?void 0:+this.params.backupID,selectedImageID:this.params.imageID??Ge,selectedLinodeID:isNaN(+this.params.linodeID)?void 0:+this.params.linodeID,selectedRegionID:this.params.regionID,selectedTypeID:this.params.typeID,showGDPRCheckbox:!!(!((_=this.props.profile.data)!=null&&_.restricted)&&ve(Ae(this.props.regionsData,this.params.regionID))&&((M=(R=this.props.agreements)==null?void 0:R.data)!=null&&M.eu_model)),signedAgreement:!1});r(this,"submitForm",(e,t)=>{const{createType:s}=this.props,{signedAgreement:o}=this.state,n={...e};if(n.root_pass){const l=Le(n.root_pass);if(l){this.setState({errors:[{field:"root_pass",reason:l}]},()=>{u()});return}}if(this.state.selectedVPCId!==void 0&&this.state.selectedVPCId!==-1){const l=re({mustBeIPMask:!1,shouldHaveIPMask:!1,value:this.state.vpcIPv4AddressOfLinode});if(!this.state.autoassignIPv4WithinVPCEnabled&&!l)return this.setState(()=>({errors:[{field:"ipv4.vpc",reason:"Must be a valid IPv4 address, e.g. 192.168.2.0"}]}),()=>u())}if(s==="fromLinode"&&!t)return this.setState(()=>({errors:[{field:"linode_id",reason:"You must select a Linode to clone from"}]}),()=>u());if(s==="fromBackup"&&!this.state.selectedBackupID){this.setState({errors:[{field:"backup_id",reason:"You must select a Backup."}]},()=>{u()});return}if(s==="fromStackScript"&&!this.state.selectedStackScriptID)return this.setState(()=>({errors:[{field:"stackscript_id",reason:"You must select a StackScript."}]}),()=>u());if(s==="fromApp"&&!this.state.selectedStackScriptID)return this.setState(()=>({errors:[{field:"stackscript_id",reason:"You must select a Marketplace App."}]}),()=>u());const d=s==="fromLinode"?()=>this.props.linodeActions.cloneLinode({sourceLinodeId:t,...n}):()=>this.props.linodeActions.createLinode(n);return this.setState({formIsSubmitting:!0}),d().then(l=>{this.setState({formIsSubmitting:!1}),o&&this.props.queryClient.executeMutation({mutationFn:ne,mutationKey:k,onError:de,variables:{eu_model:!0,privacy_policy:!0},...le(k,this.props.queryClient)}),He(s,n,this.state.selectedStackScriptLabel),this.props.enqueueSnackbar(`Your Linode ${l.label} is being created.`,{variant:"success"}),ge(),this.state.selectedVPCId!==void 0&&this.state.selectedVPCId!==-1&&this.props.queryClient.invalidateQueries([De,"paginated"]),this.props.history.push(`/linodes/${l.id}`)}).catch(l=>{this.setState(()=>({errors:y(l),formIsSubmitting:!1}),()=>u())})});r(this,"toggleAssignPublicIPv4Address",()=>{this.setState({assignPublicIPv4Address:!this.state.assignPublicIPv4Address})});r(this,"toggleAutoassignIPv4WithinVPCEnabled",()=>{this.setState({autoassignIPv4WithinVPCEnabled:!this.state.autoassignIPv4WithinVPCEnabled}),this.state.autoassignIPv4WithinVPCEnabled&&this.setState({vpcIPv4AddressOfLinode:""})});r(this,"toggleBackupsEnabled",()=>this.setState({backupsEnabled:!this.state.backupsEnabled}));r(this,"togglePrivateIPEnabled",()=>this.setState({privateIPEnabled:!this.state.privateIPEnabled}));r(this,"updateCustomLabel",e=>{this.setState({customLabel:e})})}componentDidMount(){B.includes(this.props.createType)&&this.setState({selectedImageID:void 0})}componentDidUpdate(e){var t;if(Qe(e.createType,this.props.createType)&&this.setState({selectedImageID:void 0}),e.location.search!==this.props.history.location.search){const{showGDPRCheckbox:s}=w({agreements:(t=this.props.agreements)==null?void 0:t.data,profile:this.props.profile.data,regions:this.props.regionsData,selectedRegionId:this.params.regionID});this.params=L(this.props.location.search),this.setState({showGDPRCheckbox:s})}}render(){var I,m,g;const{grants:e,profile:t,regionsData:s,typesData:o,...n}=this.props,{udfs:d,...l}=this.state,h=o==null?void 0:o.map(C),p=!!((I=t.data)!=null&&I.restricted)&&!((m=e.data)!=null&&m.global.add_linodes);return S.jsxs(b.Fragment,{children:[S.jsx(te,{segment:"Create a Linode"}),S.jsx(Ie,{bannerLocation:"LinodeCreate"}),S.jsxs(se,{className:"m0",container:!0,spacing:0,children:[S.jsx(ue,{onDocsClick:()=>ae("Getting Started"),docsLabel:"Getting Started",docsLink:"https://www.linode.com/docs/guides/platform/get-started/",title:"Create"}),S.jsx(Ce,{accountBackupsEnabled:((g=this.props.accountSettings.data)==null?void 0:g.backups_enabled)??!1,toggleAutoassignIPv4WithinVPCEnabled:this.toggleAutoassignIPv4WithinVPCEnabled,autoassignIPv4WithinVPC:this.state.autoassignIPv4WithinVPCEnabled,checkValidation:this.checkValidation,firewallId:this.state.selectedfirewallId,handleAgreementChange:this.handleAgreementChange,handleFirewallChange:this.handleFirewallChange,handleSelectUDFs:this.setUDFs,handleShowApiAwarenessModal:this.handleShowApiAwarenessModal,handleSubmitForm:this.submitForm,handleSubnetChange:this.handleSubnetChange,handleVLANChange:this.handleVLANChange,handleVPCIPv4Change:this.handleVPCIPv4Change,imageDisplayInfo:this.getImageInfo(),ipamAddress:this.state.vlanIPAMAddress,label:this.generateLabel(),regionDisplayInfo:this.getRegionInfo(),regionsData:s,resetCreationState:this.clearCreationState,selectedRegionID:this.state.selectedRegionID,selectedUDFs:d,selectedVPCId:this.state.selectedVPCId,setAuthorizedUsers:this.setAuthorizedUsers,setBackupID:this.setBackupID,setSelectedVPC:this.handleVPCChange,toggleAssignPublicIPv4Address:this.toggleAssignPublicIPv4Address,toggleBackupsEnabled:this.toggleBackupsEnabled,togglePrivateIPEnabled:this.togglePrivateIPEnabled,typeDisplayInfo:this.getTypeInfo(),typesData:h,updateDiskSize:this.setDiskSize,updateImageID:this.setImageID,updateLabel:this.updateCustomLabel,updateLinodeID:this.setLinodeID,updatePassword:this.setPassword,updateRegionID:this.setRegionID,updateStackScript:this.setStackScript,updateTags:this.setTags,updateTypeID:this.setTypeID,updateUserData:this.setUserData,userCannotCreateLinode:p,vlanLabel:this.state.attachedVLANLabel,vpcIPv4AddressOfLinode:this.state.vpcIPv4AddressOfLinode,...n,...l})]})]})}}const $e=a=>({createType:a.createLinode.type}),Ye=ce($e),Ms=ee(fe,Be,Re,Me,Ye,he,me,Se,Ue,be,_e,Ne)(Ke),qe={fromApp:{action:"one-click",labelPayloadKey:"stackscript_id"},fromBackup:{action:"backup",labelPayloadKey:"backup_id"},fromImage:{action:"image",labelPayloadKey:"image"},fromLinode:{action:"clone",labelPayloadKey:"type"},fromStackScript:{action:"stackscript",labelPayloadKey:"stackscript_id"}},He=(a,i,e)=>{const t=qe[a];let s="unknown",o="";if(t){s=t.action;const n=i[t.labelPayloadKey];isNaN(n)?o=n:o=n.toString()}e&&(o=e),pe(s,o)};export{Ms as default};
